<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Record</title>
    <link rel="stylesheet" href="/static/update_style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
</head>

<body>
    <form method="POST">
        <div class="Wrapper">
            <div class="Wrapper-inner">
                <div>
                    <div class="Header">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSdIQcKj5seecK817Ezj4mIT-a7k0NOJ8ydbg&s" alt="BNI Logo" height="7%" width="7%">
                        <p class="titleheader">EDIT RECORD </p>
                        <a href="{{ url_for('home') }}">
                            <img id="HomeBtn" height="40px" width="auto"
                                src="https://uxwing.com/wp-content/themes/uxwing/download/web-app-development/home-page-white-icon.png">
                        </a>
                    </div>
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}
                </div>
                <div class="Header-Sep"> Applicant </div>
                <div class="Flex">
                    <div>
                        <label for="applicantName" class="Label">Full Name</label>
                        <input type="text" id="applicantName" name="applicantName" value="{{ applicant.applicantName }}" required
                            class="Input">
                    </div>
                    <div style="max-width: 20%;">
                        <label for="dateOfApplication" class="Label">Date of Application</label>
                        <input type="date" name="dateOfApplication" id="dateOfApplication"
                            value="{{ applicant.dateOfApplication.strftime('%Y-%m-%d') if applicant.dateOfApplication else '' }}"
                            required class="Input">
                    </div>
                </div>
                <div class="Flex">
                    <div style="max-width: 20%;">
                        <label for="mobileNum" class="Label">Mobile Number</label>
                        <input type="tel" name="mobileNum" id="mobileNum" value="{{ applicant.mobileNum }}" required class="Input">
                    </div>
                    <div style="max-width: 30%;">
                        <label for="email" class="Label">E-mail</label>
                        <input type="email" name="email" id="email" value="{{ applicant.email }}" required class="Input">
                    </div>
                    <div>
                        <label for="deliveryAddress" class="Label">Delivery Address</label>
                        <input type="text" name="deliveryAddress" id="deliveryAddress" value="{{ applicant.deliveryAddress }}" required
                            class="Input">
                    </div>
                </div>
                <div class="Flex">
                    <div style="max-width: 25%;">
                        <label for="chapterName" class="Label">Chapter Name</label>
                        <input type="text" name="chapterName" id="chapterName" value="{{ applicant.chapterName }}" required
                            class="Input">
                    </div>
                    <div style="max-width: 30%;">
                        <label for="businessName" class="Label">Business Name</label>
                        <input type="text" name="businessName" id="businessName" value="{{ applicant.businessName }}" class="Input">
                    </div>
                    <div style="max-width: 20%;">
                        <label for="ausBusNum" class="Label">Australian Business Number</label>
                        <input type="text" name="ausBusNum" id="ausBusNum" value="{{ applicant.ausBusNum }}" maxlength="11"
                            title="ABN must be 11 digits" class="Input">
                    </div>
                    <div style="max-width: 20%;">
                        <label for="busPhoneNum" class="Label">Business Phone Number</label>
                        <input type="tel" name="busPhoneNum" id="busPhoneNum" value="{{ applicant.busPhoneNum }}" required
                            class="Input">
                    </div>
                </div>
                <div class="Flex">
                    <div>
                        <label for="website" class="Label">Business Website</label>
                        <input type="text" name="website" id="website" value="{{ applicant.website }}" class="Input">
                    </div>
                    <div>
                        <label for="businessAdd" class="Label">Business Address</label>
                        <input type="text" name="businessAdd" id="businessAdd" value="{{ applicant.businessAdd }}" required
                            class="Input">
                    </div>
                </div>
                <div class="Flex">
                    <div>
                        <label for="invitedBy" class="Label">Who invited you to BNI?</label>
                        <input type="text" name="invitedBy" id="invitedBy" value="{{ applicant.invitedBy }}" class="Input">
                    </div>
                    <div>
                        <label for="industry" class="Label">Industry Applying For?</label>
                        <select name="industry" id="industry" required class="Input">
                            <option value="" disabled selected hidden>Select Industry </option>
                            <option value="Accountancy" {% if applicant.industry=='Accountancy' %}selected{% endif %}>
                                Accountancy</option>
                            <option value="Advertising" {% if applicant.industry=='Advertising' %}selected{% endif %}>
                                Advertising</option>
                            <option value="Agribusiness" {% if applicant.industry=='Agribusiness' %}selected{% endif %}>
                                Agribusiness</option>
                            <option value="Construction" {% if applicant.industry=='Construction' %}selected{% endif %}>
                                Construction</option>
                            <option value="Electricity" {% if applicant.industry=='Electricity' %}selected{% endif %}>
                                Electricity</option>
                            <option value="Environmental" {% if applicant.industry=='Environmental' %}selected{% endif %}>Environmental
                            </option>
                            <option value="Food and Baverage" {% if applicant.industry=='Food and Baverage' %}selected{% endif %}>Food
                                and Baverage</option>
                            <option value="Healthcare" {% if applicant.industry=='Healthcare' %}selected{% endif %}>
                                Healthcare</option>
                            <option value="Information Technology" {% if applicant.industry=='Information Technology' %}selected{% endif
                                %}>Information Technology</option>
                            <option value="Insurance" {% if applicant.industry=='Insurance' %}selected{% endif %}>
                                Insurance</option>
                            <option value="Marketing" {% if applicant.industry=='Marketing' %}selected{% endif %}>
                                Marketing</option>
                            <option value="Oil, Gas, and Mining" {% if applicant.industry=='Oil, Gas, and Mining' %}selected{% endif %}>
                                Oil, Gas, and Mining</option>
                            <option value="Telecommunications" {% if applicant.industry=='Telecommunications' %}selected{% endif %}>
                                Telecommunications</option>
                        </select>
                    </div>
                    <div>
                        <label for="specialtyAppliedFor" class="Label">Business Specialty?</label>
                        <input type="text" name="specialtyAppliedFor" id="specialtyAppliedFor"
                            value="{{ applicant.specialtyAppliedFor }}" required class="Input">
                    </div>
                </div>
                <div class="Label" style="margin-top: 30px; margin-bottom: -10px;"> MEMBERSHIP QUALIFIERS </div>
                <div class="Flex">
                    <div class="radio" style="max-width: 20%;">
                        <label class="Label" style="margin-bottom: 10px;">Prepared to invite people to your BNI
                            Chapter?</label>
                        <input id="orgInvite-yes" name="orgInvite" value="yes" type="radio" {% if applicant.orgInvite=='yes' %}checked{%
                            endif %}>
                        <label for="orgInvite-yes" class="radio-label" style="margin-right: 20px;">Yes</label>
                        <input id="orgInvite-no" name="orgInvite" value="no" type="radio" {% if applicant.orgInvite=='no' %}checked{%
                            endif %}>
                        <label for="orgInvite-no" class="radio-label">No</label>
                    </div>
                    <div class="radio" style="max-width: 25%;">
                        <label class="Label" style="margin-bottom: 10px;">Have you ever been convicted of an act of
                            dishonesty or any other offence?</label>
                        <input id="convictionHistory-yes" name="convictionHistory" value="yes" type="radio" {% if
                            applicant.convictionHistory=='yes' %}checked{% endif %}>
                        <label for="convictionHistory-yes" class="radio-label" style="margin-right: 20px;">Yes</label>
                        <input id="convictionHistory-no" name="convictionHistory" value="no" type="radio" {% if
                            applicant.convictionHistory=='no' %}checked{% endif %}>
                        <label for="convictionHistory-no" class="radio-label">No</label>
                    </div>
                </div>
                <div class="Header-Sep" style="margin-top: 50px;">References</div>
                {% for i in range(1, 3) %}
                <div class="Header-Two">Reference {{ i }}</div>
                {% set reference = references[i-1] if i <= references|length else None %} <div class="Flex">
                    <div>
                        <label for="nameOfBusRef_{{ i }}" class="Label">Reference Name</label>
                        <input type="text" name="nameOfBusRef_{{ i }}" id="nameOfBusRef_{{ i }}"
                            value="{{ reference.nameOfBusRef if reference else '' }}" required class="Input">
                    </div>
                    <div style="max-width: 20%;">
                        <label for="busRefPosition_{{ i }}" class="Label">Position</label>
                        <input type="text" name="busRefPosition_{{ i }}" id="busRefPosition_{{ i }}"
                            value="{{ reference.busRefPosition if reference else '' }}" required class="Input">
                    </div>
                    <div>
                        <label for="busRefBusiness_{{ i }}" class="Label">Reference's Business Name</label>
                        <input type="text" name="busRefBusiness_{{ i }}" id="busRefBusiness_{{ i }}"
                            value="{{ reference.busRefBusiness if reference else '' }}" required class="Input">
                    </div>
                    </div>
                    <div class="Flex">
                        <div style="max-width: 20%;">
                            <label for="busRefMobileNum_{{ i }}" class="Label">Mobile Number</label>
                            <input type="tel" name="busRefMobileNum_{{ i }}" id="busRefMobileNum_{{ i }}"
                                value="{{ reference.busRefMobileNum if reference else '' }}" required class="Input">
                        </div>
                        <div>
                            <label for="busRefEmail_{{ i }}" class="Label">Email</label>
                            <input type="email" name="busRefEmail_{{ i }}" id="busRefEmail_{{ i }}"
                                value="{{ reference.busRefEmail if reference else '' }}" required class="Input">
                        </div>
                        <div style="max-width: 30%;">
                            <label for="busRefRelationship_{{ i }}" class="Label">Relationship with Reference</label>
                            <input type="text" name="busRefRelationship_{{ i }}" id="busRefRelationship_{{ i }}"
                                value="{{ reference.busRefRelationship if reference else '' }}" required class="Input">
                        </div>
                    </div>
                    {% endfor %}
                    <div class="Header-Sep" style="margin-top: 50px;">Education</div>
                    <div class="Flex">
                        <div style="max-width: 20%;">
                            <label for="yearGrad" class="Label">Year Graduated</label>
                            <input type="number" name="yearGrad" id="yearGrad"
                                value="{{ applicant.education.yearGrad if applicant.education else '' }}" min="1900" max="2024" step="1"
                                required class="Input" placeholder="YYYY">
                        </div>
                        <div>
                            <label for="schoolName" class="Label">Name of School Graduated From</label>
                            <input type="text" name="schoolName" id="schoolName"
                                value="{{ applicant.education.schoolName if applicant.education else '' }}" required class="Input">
                        </div>
                        <div>
                            <label for="schoolAddress" class="Label">School Address</label>
                            <input type="text" name="schoolAddress" id="schoolAddress"
                                value="{{ applicant.education.schoolAddress if applicant.education else '' }}" required class="Input">
                        </div>
                        <div style="max-width: 20%;">
                            <label for="degree" class="Label">Degree Achieved</label>
                            <input type="text" name="degree" id="degree"
                                value="{{ applicant.education.degree if applicant.education else '' }}" required class="Input">
                        </div>
                    </div>
                    <input type="submit" style="margin-top: 60px; margin-left:505px; margin-bottom:20px;" value="CONFIRM CHANGES" class="Button">
            </div>
        </div>   
    </form>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        // ABN validation and formatting
        $("#ausBusNum").on('input', function () {
            // Remove non-digit characters
            let value = $(this).val().replace(/\D/g, '');

            // Truncate to 11 digits if longer
            if (value.length > 11) {
                value = value.substr(0, 11);
            }

            // Update input value
            $(this).val(value);
        });

        // Form submission validation
        $('form').submit(function (e) {
            let abn = $("#ausBusNum").val();
            if (abn && abn.length !== 11) {
                alert('ABN must be 11 digits');
                e.preventDefault();
                return false;
            }

            // Function to format and validate Australian mobile numbers
            function formatMobileNumber(input) {
                let value = input.value.replace(/\D/g, '');
                if (value.length > 0 && value[0] !== '0') {
                    value = '0' + value;
                }
                let formattedNumber = '';
                if (value.length > 0) {
                    formattedNumber = value.substring(0, 4) + ' ';
                    if (value.length > 4) {
                        formattedNumber += value.substring(4, 7) + ' ';
                        if (value.length > 7) {
                            formattedNumber += value.substring(7, 10);
                        } else {
                            formattedNumber += value.substring(7);
                        }
                    } else {
                        formattedNumber += value.substring(4);
                    }
                }
                input.value = formattedNumber.trim();
            }

            // Apply formatting to all mobile number inputs
            $('input[type="tel"]').on('input', function () {
                formatMobileNumber(this);
            });

            // Validate mobile numbers before form submission
            $('form').submit(function (e) {
                let isValid = true;
                $('input[type="tel"]').each(function () {
                    if (!this.checkValidity()) {
                        alert('Please enter a valid Australian mobile number in the format: 04xx xxx xxx');
                        isValid = false;
                        return false;
                    }
                });
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>

</html>